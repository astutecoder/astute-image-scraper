const user_defined=require("./settings"),puppet=require("puppeteer"),fs=require("fs"),request=require("request");(async()=>{try{const e=await puppet.launch({defaultViewport:{width:1920,height:1080}}),t=await e.newPage();await t.goto(user_defined.settings.url,{waitUntil:"networkidle2"}),console.info("Scraping started. Please wait...");let r=await t.evaluate(async()=>{await(()=>new Promise(e=>{let t=setInterval(function(){document.body.scrollHeight!==window.innerHeight+window.scrollY?window.scrollTo(0,document.body.scrollHeight):document.querySelector("#smb")?(document.querySelector("#smb").click(),document.querySelector("#smb").remove()):(clearInterval(t),e("done"))},1e3)}))();let e=Array.from(document.querySelectorAll('a[jsname="hSRGPd"]')),t=[];for(imageBox of e){let e=imageBox.getAttribute("href"),r=String(e.split("=")[1]).replace("&imgrefurl","");t.push(decodeURIComponent(r))}return t});await e.close();let o=(e,t="",r=1)=>{let o=t?t+"_"+r+".jpg":r+".jpg";request.get(e).on("error",e=>console.dir(e)).pipe(fs.createWriteStream(user_defined.settings.path+"/"+o)).on("close",()=>console.log("download complete:",o))},i=1;for(image of r){if(await o(image,user_defined.settings.prefix,user_defined.settings.start_from),i===user_defined.settings.download_limit)break;user_defined.settings.start_from++,i++}}catch(e){console.error(e)}})();